// bot.js - Telegram Bot Server
require('dotenv').config();
const TelegramBot = require('node-telegram-bot-api');

// ะะฐะผะตะฝะธัะต ะฝะฐ ะฒะฐั ัะพะบะตะฝ ะฑะพัะฐ ะพั @BotFather
const BOT_TOKEN = process.env.BOT_TOKEN || 'YOUR_BOT_TOKEN';
// URL ะฒะฐัะตะณะพ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั (ะทะฐะผะตะฝะธัะต ะฝะฐ ะฒะฐั ัะตะฐะปัะฝัะน URL)
const WEB_APP_URL = process.env.WEB_APP_URL || 'https://your-app-url.vercel.app';

// ะกะพะทะดะฐะตะผ ะฑะพัะฐ
const bot = new TelegramBot(BOT_TOKEN, { polling: true });

console.log('๐ค ะะพั ะทะฐะฟััะตะฝ!');

// ะะฑัะฐะฑะพััะธะบ ะบะพะผะฐะฝะดั /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name || 'ะดััะณ';

  // ะัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต
  const welcomeMessage = `
๐ถ ะัะธะฒะตั, ${firstName}!

ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ **ะขัะตะบะตั ะผะฐะปััะฐ** โ ัะดะพะฑะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะฐะบัะธะฒะฝะพััะตะน ะฒะฐัะตะณะพ ัะตะฑะตะฝะบะฐ.

๐ ะก ะฟะพะผะพััั ััะพะณะพ ะฑะพัะฐ ะฒั ัะผะพะถะตัะต:
โข ะััะปะตะถะธะฒะฐัั ะบะพัะผะปะตะฝะธะต, ัะพะฝ ะธ ะฟัะพะณัะปะบะธ
โข ะะตััะธ ััะตั ัะผะตะฝั ะฟะพะดะณัะทะฝะธะบะพะฒ
โข ะะฐะฟะธััะฒะฐัั ะฟัะธะตะผ ะปะตะบะฐัััะฒ ะธ ะบัะฟะฐะฝะธั
โข ะกะปะตะดะธัั ะทะฐ ัะพััะพะผ ะธ ะฒะตัะพะผ ะผะฐะปััะฐ
โข ะะพะปััะฐัั ะฝะฐะฟะพะผะธะฝะฐะฝะธั ะธ ัะฒะตะดะพะผะปะตะฝะธั
โข ะัะพัะผะฐััะธะฒะฐัั ััะฐัะธััะธะบั ะธ ะธััะพัะธั

ะะฐะถะผะธัะต ะบะฝะพะฟะบั ะฝะธะถะต, ััะพะฑั ะพัะบัััั ะฟัะธะปะพะถะตะฝะธะต! ๐
  `.trim();

  // ะะปะฐะฒะธะฐัััะฐ ั ะบะฝะพะฟะบะพะน ะดะปั ะพัะบัััะธั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั
  const keyboard = {
    inline_keyboard: [
      [
        {
          text: '๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต',
          web_app: { url: WEB_APP_URL }
        }
      ],
      [
        {
          text: 'โ ะะพะผะพัั',
          callback_data: 'help'
        },
        {
          text: '๐ ะ ะฟัะธะปะพะถะตะฝะธะธ',
          callback_data: 'about'
        }
      ]
    ]
  };

  bot.sendMessage(chatId, welcomeMessage, {
    parse_mode: 'Markdown',
    reply_markup: keyboard
  });
});

// ะะฑัะฐะฑะพััะธะบ ะบะพะผะฐะฝะดั /help
bot.onText(/\/help/, (msg) => {
  const chatId = msg.chat.id;

  const helpMessage = `
๐ **ะะพะผะพัั ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั**

**ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ:**

๐ผ **ะะพัะผะปะตะฝะธะต**
ะััะปะตะถะธะฒะฐะนัะต ะณััะดะฝะพะต ะฒัะบะฐัะผะปะธะฒะฐะฝะธะต (ั ัะฐะนะผะตัะพะผ ะดะปั ะบะฐะถะดะพะน ะณััะดะธ) ะธ ะบะพัะผะปะตะฝะธะต ะธะท ะฑัััะปะพัะบะธ

๐ด **ะกะพะฝ**
ะะฐะฟะธััะฒะฐะนัะต ะฒัะตะผั ัะฝะฐ ั ะฟะพะผะพััั ัะฐะนะผะตัะฐ ะธะปะธ ะฒัััะฝัั

๐ถ **ะัะพะณัะปะบะธ**
ะัะผะตัะฐะนัะต ะฒัะตะผั ะฟัะพะณัะปะพะบ ะฝะฐ ัะฒะตะถะตะผ ะฒะพะทะดััะต

๐งท **ะะพะดะณัะทะฝะธะบะธ**
ะะตะดะธัะต ััะตั ัะผะตะฝั ะฟะพะดะณัะทะฝะธะบะพะฒ (ะผะพะบััะน/ะณััะทะฝัะน)

๐ **ะะตะบะฐัััะฒะฐ**
ะะฐะฟะธััะฒะฐะนัะต ะฟัะธะตะผ ะปะตะบะฐัััะฒ ั ัะบะฐะทะฐะฝะธะตะผ ะฝะฐะทะฒะฐะฝะธั

๐ **ะัะฟะฐะฝะธะต**
ะัะผะตัะฐะนัะต ะฒัะตะผั ะบัะฟะฐะฝะธั

๐ **ะกัะฐัะธััะธะบะฐ**
ะัะพัะผะฐััะธะฒะฐะนัะต ัะตะฟะปะพะฒัั ะบะฐััั ะฐะบัะธะฒะฝะพััะตะน ะฟะพ ะฝะตะดะตะปัะผ

๐ถ **ะัะพัะธะปั**
ะะตะดะธัะต ะดะฐะฝะฝัะต ะพ ัะพััะต ะธ ะฒะตัะต ะผะฐะปััะฐ ั ะณัะฐัะธะบะฐะผะธ ะดะธะฝะฐะผะธะบะธ

๐ **ะฃะฒะตะดะพะผะปะตะฝะธั**
ะะฐัััะฐะธะฒะฐะนัะต ะฝะฐะฟะพะผะธะฝะฐะฝะธั ะฟะพ ะฒัะตะผะตะฝะธ ะธะปะธ ะธะฝัะตัะฒะฐะปะฐะผ

**ะะพะผะฐะฝะดั ะฑะพัะฐ:**
/start - ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต
/help - ะะพะบะฐะทะฐัั ััั ัะฟัะฐะฒะบั

ะััั ะฒะพะฟัะพัั? ะะฐะฟะธัะธัะต ะฝะฐะผ!
  `.trim();

  const keyboard = {
    inline_keyboard: [
      [
        {
          text: '๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต',
          web_app: { url: WEB_APP_URL }
        }
      ]
    ]
  };

  bot.sendMessage(chatId, helpMessage, {
    parse_mode: 'Markdown',
    reply_markup: keyboard
  });
});

// ะะฑัะฐะฑะพััะธะบ callback ะบะฝะพะฟะพะบ
bot.on('callback_query', (query) => {
  const chatId = query.message.chat.id;
  const data = query.data;

  switch (data) {
    case 'help':
      bot.answerCallbackQuery(query.id);
      bot.sendMessage(chatId, `
๐ **ะััััะฐั ะฟะพะผะพัั**

ะัะฟะพะปัะทัะนัะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั:
โ ะััะปะตะถะธะฒะฐะฝะธั ะฒัะตั ะฐะบัะธะฒะฝะพััะตะน ะผะฐะปััะฐ
โ ะะตะดะตะฝะธั ะธััะพัะธะธ ัะพััะฐ ะธ ะฒะตัะฐ
โ ะะพะปััะตะฝะธั ััะฐัะธััะธะบะธ ะธ ะณัะฐัะธะบะพะฒ
โ ะะฐัััะพะนะบะธ ะฝะฐะฟะพะผะธะฝะฐะฝะธะน

ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต ะธ ะฝะฐัะฝะธัะต ะพััะปะตะถะธะฒะฐัั ะฐะบัะธะฒะฝะพััะธ ะฟััะผะพ ัะตะนัะฐั!

ะะปั ะฟะพะดัะพะฑะฝะพะน ัะฟัะฐะฒะบะธ ะธัะฟะพะปัะทัะนัะต ะบะพะผะฐะฝะดั /help
      `.trim(), {
        parse_mode: 'Markdown',
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: '๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต',
                web_app: { url: WEB_APP_URL }
              }
            ]
          ]
        }
      });
      break;

    case 'about':
      bot.answerCallbackQuery(query.id);
      bot.sendMessage(chatId, `
๐ถ **ะ ะฟัะธะปะพะถะตะฝะธะธ**

**ะขัะตะบะตั ะผะฐะปััะฐ** โ ััะพ ัะพะฒัะตะผะตะฝะฝะพะต ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะดะปั ัะพะดะธัะตะปะตะน, ะบะพัะพัะพะต ะฟะพะผะพะณะฐะตั ะฒะตััะธ ััะตั ะฒัะตั ะฒะฐะถะฝัั ะผะพะผะตะฝัะพะฒ ะฒ ะถะธะทะฝะธ ะฒะฐัะตะณะพ ัะตะฑะตะฝะบะฐ.

**ะะพะทะผะพะถะฝะพััะธ:**
โข ๐ ะฃะดะพะฑะฝะพะต ะพััะปะตะถะธะฒะฐะฝะธะต ะฐะบัะธะฒะฝะพััะตะน
โข โฑ๏ธ ะัััะพะตะฝะฝัะต ัะฐะนะผะตัั ะดะปั ะบะพัะผะปะตะฝะธั ะธ ัะฝะฐ
โข ๐ ะะธะทัะฐะปะธะทะฐัะธั ััะฐัะธััะธะบะธ
โข ๐ฑ ะะฐะฑะพัะฐะตั ะฟััะผะพ ะฒ Telegram
โข ๐ ะฃะผะฝัะต ะฝะฐะฟะพะผะธะฝะฐะฝะธั
โข ๐พ ะะฑะปะฐัะฝะพะต ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั
โข ๐ ะกะธะฝััะพะฝะธะทะฐัะธั ะผะตะถะดั ััััะพะนััะฒะฐะผะธ

**ะะตััะธั:** 1.0.0

ะกะดะตะปะฐะฝะพ ั โค๏ธ ะดะปั ะทะฐะฑะพัะปะธะฒัั ัะพะดะธัะตะปะตะน
      `.trim(), {
        parse_mode: 'Markdown',
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: '๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต',
                web_app: { url: WEB_APP_URL }
              }
            ]
          ]
        }
      });
      break;
  }
});

// ะะฑัะฐะฑะพัะบะฐ ะดััะณะธั ัะพะพะฑัะตะฝะธะน
bot.on('message', (msg) => {
  // ะะณะฝะพัะธััะตะผ ะบะพะผะฐะฝะดั, ะบะพัะพััะต ัะถะต ะพะฑัะฐะฑะพัะฐะฝั
  if (msg.text && msg.text.startsWith('/')) {
    return;
  }

  const chatId = msg.chat.id;

  // ะััะถะตะปัะฑะฝัะน ะพัะฒะตั ะฝะฐ ะพะฑััะฝัะต ัะพะพะฑัะตะฝะธั
  const responses = [
    'ะัะฟะพะปัะทัะนัะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะทะฐะฟะธัะธ ะฐะบัะธะฒะฝะพััะตะน! ะะฐะถะผะธัะต ะบะฝะพะฟะบั ะฝะธะถะต ๐',
    'ะะปั ะฝะฐัะฐะปะฐ ัะฐะฑะพัั ะพัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต ัะตัะตะท ะบะฝะพะฟะบั ะฝะธะถะต! ๐',
    'ะัะต ััะฝะบัะธะธ ะดะพัััะฟะฝั ะฒ ะฟัะธะปะพะถะตะฝะธะธ. ะัะบัะพะนัะต ะตะณะพ ะฟััะผะพ ัะตะนัะฐั! ๐'
  ];

  const randomResponse = responses[Math.floor(Math.random() * responses.length)];

  bot.sendMessage(chatId, randomResponse, {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: '๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต',
            web_app: { url: WEB_APP_URL }
          }
        ]
      ]
    }
  });
});

// ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
bot.on('polling_error', (error) => {
  console.error('Polling error:', error);
});

// Graceful shutdown
process.on('SIGINT', () => {
  console.log('\n๐ ะััะฐะฝะพะฒะบะฐ ะฑะพัะฐ...');
  bot.stopPolling();
  process.exit(0);
});

process.on('SIGTERM', () => {
  console.log('\n๐ ะััะฐะฝะพะฒะบะฐ ะฑะพัะฐ...');
  bot.stopPolling();
  process.exit(0);
});
